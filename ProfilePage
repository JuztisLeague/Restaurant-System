package BonAppetit;




import java.awt.Dimension;
import java.awt.Frame;
//import com.sun.jdi.connect.spi.Connection;
//import java.io.FileWriter;
import java.io.IOException;
import javax.swing.JOptionPane;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JLabel;
import javax.swing.JButton;
import javax.swing.JPasswordField;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;
import java.awt.Font;
import javax.swing.SwingConstants;
import javax.swing.JTextField;
import java.awt.Color;
import javax.swing.border.BevelBorder;
import javax.swing.border.SoftBevelBorder;
//import javax.swing.JOptionPane;


/**
 *
 * @author Admin
 */
public class ProfilePage extends javax.swing.JFrame {
   //private JTextField passwordField;
  
    /**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	public ProfilePage() {
		setPreferredSize(new Dimension(1920, 1080));
		connect();
		setUndecorated(true);
    	setExtendedState(Frame.MAXIMIZED_BOTH);
    	
        initComponents();
    }
    
    Connection con;
	PreparedStatement pst;
	ResultSet rs;
	private JLabel lblNewPassword;
	private JLabel lblConfirmPassword;
    
    public void connect() {
		try {
			Class.forName("com.mysql.cj.jdbc.Driver");
			con = DriverManager.getConnection("jdbc:mysql://localhost:3306/bon_appetit", "root", "");
		}
		
		catch (ClassNotFoundException ex) {
	        ex.printStackTrace();
	        JOptionPane.showMessageDialog(null, "Failed to connect to database. ClassNotFoundException: " + ex.getMessage());
	    } catch (SQLException ex) {
	        ex.printStackTrace();
	        JOptionPane.showMessageDialog(null, "Failed to connect to database. SQLException: " + ex.getMessage());
	    }
	}

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">                          
    private void initComponents() {
    	
    	
        jPanel1 = new javax.swing.JPanel();
        jPanel1.setBackground(new Color(0, 64, 64));
        jLabelPassword = new javax.swing.JLabel();
        jLabelPassword.setForeground(new Color(255, 255, 255));
        jLabelPassword.setBounds(817, 349, 266, 36);
        jLabelPassword.setHorizontalAlignment(SwingConstants.CENTER);
        jLabel2 = new javax.swing.JLabel();
        jLabel2.setForeground(new Color(255, 255, 255));
        jLabel2.setBounds(0, 16, 1910, 62);
        jBtnSave = new javax.swing.JButton();
        jBtnSave.setBounds(912, 638, 92, 36);
        jLabel3 = new javax.swing.JLabel();
        jLabel3.setForeground(new Color(255, 255, 255));
        jLabel3.setBounds(932, 238, 58, 36);
        jLabel3.setHorizontalAlignment(SwingConstants.CENTER);

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setPreferredSize(new java.awt.Dimension(547, 0));

        jLabelPassword.setFont(new Font("Century Gothic", Font.BOLD, 18)); // NOI18N
        jLabelPassword.setText("Password");

        jLabel2.setFont(new Font("Century Gothic", Font.PLAIN, 48)); // NOI18N
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel2.setText("Profile");

        jBtnSave.setText("Save");
        jBtnSave.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                jButtonSaveActionPerformed(e);
            }
        });
        jBtnSave.setVisible(false);

        jLabel3.setFont(new Font("Century Gothic", Font.BOLD, 18)); // NOI18N
        jLabel3.setText("Role");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 553, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 550, Short.MAX_VALUE)
        );
        
        btnCheckPassword = new JButton("Check");
        btnCheckPassword.setBounds(995, 398, 76, 36);
        btnCheckPassword.setFont(new Font("Tahoma", Font.PLAIN, 11));
        btnCheckPassword.addFocusListener(new FocusAdapter() {
        	@Override
        	public void focusGained(FocusEvent e) {
        		passwordField_CurrentPass.setEchoChar((char)0);
        	}
        	@Override
        	public void focusLost(FocusEvent e) {
        		passwordField_CurrentPass.setEchoChar('\u25cf');
        	}
        });
        btnCheckPassword.setVisible(false);
        
        btnBack = new JButton("Back");
        btnBack.setBounds(10, 16, 99, 62);
        btnBack.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		
        		jBtnBackActionPerformed(e);
        		
        	}
        });
        
        btnClose = new JButton("Close");
        btnClose.setBounds(1798, 11, 112, 46);
        btnClose.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		System.exit(0);
        	}
        });
        jPanel1.setLayout(null);
        btnClose.setFont(new Font("Tahoma", Font.PLAIN, 18));
        btnClose.setFocusable(false);
        jPanel1.add(btnClose);
        btnBack.setFont(new Font("Century Gothic", Font.PLAIN, 20));
        btnBack.setFocusable(false);
        jPanel1.add(btnBack);
        jPanel1.add(btnCheckPassword);
        jPanel1.add(jLabel2);
        jPanel1.add(jLabel3);
        jPanel1.add(jBtnSave);
        jPanel1.add(jLabelPassword);
        
        JLabel lblNewLabel = new JLabel("USER PHOTO");
        lblNewLabel.setBackground(new Color(255, 255, 255));
        lblNewLabel.setForeground(new Color(255, 255, 255));
        lblNewLabel.setBorder(new BevelBorder(BevelBorder.LOWERED, null, null, null, null));
        lblNewLabel.setBounds(858, 111, 164, 97);
        lblNewLabel.setHorizontalAlignment(SwingConstants.CENTER);
        jPanel1.add(lblNewLabel);
        
        btnEditPassword = new JButton("Edit Password");
        btnEditPassword.setBorder(new SoftBevelBorder(BevelBorder.LOWERED, null, null, null, null));
        btnEditPassword.setBounds(1145, 405, 146, 23);
        btnEditPassword.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		
        		jBtnEditPasswordActionPerformed();
        	}
        });
        jPanel1.add(btnEditPassword);
        
        passwordField_CurrentPass = new JPasswordField(20);
        passwordField_CurrentPass.setBounds(817, 393, 266, 46);
        passwordField_CurrentPass.setBackground(new Color(255, 255, 255));
        passwordField_CurrentPass.setFocusable(false);
        jPanel1.add(passwordField_CurrentPass);
        
        passwordField_NewPass = new JPasswordField(20);
        passwordField_NewPass.setBounds(817, 478, 266, 36);
        jPanel1.add(passwordField_NewPass);
        passwordField_NewPass.setVisible(false);
        
        passwordField_ConfirmPass = new JPasswordField(20);
        passwordField_ConfirmPass.setBounds(817, 552, 266, 36);
        jPanel1.add(passwordField_ConfirmPass);
        passwordField_ConfirmPass.setVisible(false);
        
        
        lblNewPassword = new JLabel();
        lblNewPassword.setForeground(new Color(255, 255, 255));
        lblNewPassword.setBounds(817, 437, 266, 36);
        lblNewPassword.setHorizontalAlignment(SwingConstants.CENTER);
        lblNewPassword.setText("New Password");
        lblNewPassword.setFont(new Font("Century Gothic", Font.BOLD, 18));
        jPanel1.add(lblNewPassword);
        lblNewPassword.setVisible(false);
        
        lblConfirmPassword = new JLabel();
        lblConfirmPassword.setForeground(new Color(255, 255, 255));
        lblConfirmPassword.setBounds(817, 516, 266, 36);
        lblConfirmPassword.setHorizontalAlignment(SwingConstants.CENTER);
        lblConfirmPassword.setText("Confirm Password");
        lblConfirmPassword.setFont(new Font("Century Gothic", Font.BOLD, 18));
        jPanel1.add(lblConfirmPassword);
        
        txtRole = new JTextField();
        txtRole.setBounds(817, 274, 266, 36);
        txtRole.setText("Sample");
        jPanel1.add(txtRole);
        txtRole.setColumns(10);
        txtRole.setFocusable(false);
        
        JButton btnCancel = new JButton("Cancel");
        btnCancel.setBorder(new SoftBevelBorder(BevelBorder.LOWERED, null, null, null, null));
        btnCancel.setBounds(1145, 447, 146, 23);
        btnCancel.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		
        		jBtnCancelActionPerformed();
        	}
        });
        jPanel1.add(btnCancel);
        lblConfirmPassword.setVisible(false);
        
        
        
        
        dataIndicator();
        

        
        pack();
    }// </editor-fold>                       

    
    private void dataIndicator() {
    	
    	try {
    		
    		int id = PersonnelLogin.storedPersonnelID();
    		System.out.print(id);
			pst = con.prepareStatement("select * from accounts where id = ?");
			pst.setString(1, Integer.toString(id));
			rs = pst.executeQuery();
			 
			 if (rs.next() == true) {
				 
				txtRole.setText(rs.getString("role"));
				passwordField_CurrentPass.setText(rs.getString("password"));
			 }
			
			
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
    }
    
    

    
    
    private void jButtonSaveActionPerformed(ActionEvent e) {                                         
       
        try {
            //jButton1ActionPerformed.addActionListener(new ActionListener() {
            //public void actionPerformed(ActionEvent e) {
        	
        	
        	
        	passwordConfirm = passwordField_ConfirmPass.getPassword();
        	
        	if(passwordCurrentChecker()) {
        		
        		if (passwordNewChecker()) {
        			int id = PersonnelLogin.storedPersonnelID();
        			pst = con.prepareStatement("update accounts set password = ? where id = ?");
        			pst.setString(1, String.valueOf(passwordConfirm));
        			pst.setString(2, Integer.toString(id));
        			pst.executeUpdate();
        					
        			JOptionPane.showMessageDialog(this, "Successfully Changed", "PasswordChange", JOptionPane.OK_CANCEL_OPTION);
        		}
        			
        	}
        	
        	else {
        		JOptionPane.showMessageDialog(this, "Error", "PasswordChange", JOptionPane.OK_CANCEL_OPTION);
        	}
        	
				 
			
   				 
        } catch (SQLException el) {
        	el.printStackTrace();
        }

    }
    
    private boolean passwordCurrentChecker() {
    	
    	try {
    		
    		int id = PersonnelLogIn.storedPersonnelID();
    		System.out.print(id);
			pst = con.prepareStatement("select password from accounts where id = ?");
			pst.setString(1, Integer.toString(id));
			rs = pst.executeQuery();
			
			passwordCorrect = rs.getString(1).toCharArray();
			passwordCurrent = passwordField_CurrentPass.getPassword();
			//passwordNew = passwordField_NewPass.getPassword();
			
			if (passwordCurrent.length != passwordCorrect.length){
				return false;
				
			}
			
			for (int i = 0; i < passwordCorrect.length; i++) {
				
				if (passwordCurrent[i] != passwordCorrect[i] ) {
					return false;
				}
				
			}
			
			
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
    	return true;
    	
    	
    }
    
    
    private boolean passwordNewChecker() {
    	
    		
    		int id = PersonnelLogin.storedPersonnelID();
    		System.out.print(id);
    		
    		passwordNew = passwordField_NewPass.getPassword();
    		passwordConfirm = passwordField_ConfirmPass.getPassword();
			
			if (passwordNew.length != passwordConfirm.length){
				return false;
				
			}
			
			for (int i = 0; i < passwordConfirm.length; i++) {
				
				if (passwordConfirm[i] != passwordNew[i] ) {
					return false;
				}
				
			}
    	
		return true;
    	
    }
    
    public void jBtnEditPasswordActionPerformed() {
    	lblNewPassword.setVisible(true);
    	lblConfirmPassword.setVisible(true);
    	passwordField_NewPass.setVisible(true);
    	passwordField_ConfirmPass.setVisible(true);
    	passwordField_CurrentPass.setText("");
    	jBtnSave.setVisible(true);
    	btnCheckPassword.setVisible(true);
    	btnCancel.setVisible(true);
    	
    	passwordField_CurrentPass.setEditable(true);
    	passwordField_CurrentPass.setFocusable(true);
    	passwordField_CurrentPass.requestFocus();
    	
    	jLabelPassword.setText("Current Password");
    	
    }
    
    public void jBtnCancelActionPerformed() {
    	lblNewPassword.setVisible(false);
    	lblConfirmPassword.setVisible(false);
    	passwordField_NewPass.setVisible(false);
    	passwordField_ConfirmPass.setVisible(false);
    	
    	jBtnSave.setVisible(false);
    	btnCheckPassword.setVisible(false);
    	
    	passwordField_CurrentPass.setEditable(false);
    	passwordField_CurrentPass.setFocusable(false);
    	
    	jLabelPassword.setText("Password");
    	
    	dataIndicator();
    	
    	btnCancel.setVisible(false);
    }
    
    
    private void jBtnBackActionPerformed(ActionEvent e) {        
    	
    	switch(PersonnelLogin.storedPersonnelID()) {
    	case 1:{
    		OptionsAdmin optionsAdmin = new OptionsAdmin();
    		optionsAdmin.setVisible(true);
            this.dispose();
    		break;
    	}
    	case 2:{
    		OptionsChef optionsChef = new OptionsChef();
    		optionsChef.setVisible(true);
            this.dispose();
    		break;
    	}
    	case 3:{
    		OptionsCashier optionsCashier = new OptionsCashier();
    		optionsCashier.setVisible(true);
            this.dispose();
    		break;
    	}
    		
    		
    	}
    	
    	
        
        
       
   }   
    
    /*private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {                                         
    
    try {
        //jButton1ActionPerformed.addActionListener(new ActionListener() {
        //public void actionPerformed(ActionEvent e) {
        savePassword();
    } catch (IOException ex) {
        Logger.getLogger(ProfilePage.class.getName()).log(Level.SEVERE, null, ex);
    }

}             


/*private void savePassword() throws IOException {
    String role = jTextField2.getText();
    String password = jTextField1.getText();

    if (password.length() != 5 || !password.matches("\\d+")) {
    	JOptionPane.showMessageDialog(this, "Please enter a valid 5-digit password.", "Error", JOptionPane.ERROR_MESSAGE);
    	return;
    }

    try {
    	// Connect to the database
    	Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/tablemanagement_database", "root", "");
 
    	// Prepare the SQL statement
    	String sql = "INSERT INTO password (role, password) VALUES (?, ?)";
    	PreparedStatement statement = conn.prepareStatement(sql);
    	statement.setString(1, role);
    	statement.setString(2, password);
 
    	// Execute the statement
    	int rowsInserted = statement.executeUpdate();
    	if (rowsInserted > 0) {
    		JOptionPane.showMessageDialog(this, "Password saved successfully.");
    	} else {
    		JOptionPane.showMessageDialog(this, "Error saving password.", "Error", JOptionPane.ERROR_MESSAGE);
    	}
 
    	// Close the connection and statement
    	statement.close();
    	conn.close();
    } catch (SQLException e) {
    	JOptionPane.showMessageDialog(this, "Error connecting to database: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
    }
}*/
    
    
    /*private void savePassword() throws IOException {
        String role = txtRole.getText();
        String password = passwordField_CurrentPass.getText();
        
        if (password.length() != 5 || !password.matches("\\d+")) {
            JOptionPane.showMessageDialog(this, "Please enter a valid 5-digit password.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        try {
            
        	int id = PersonnelLogin.storedPersonnelID();
        	
            pst = con.prepareStatement("select * from accounts where id = ?");
            pst.setString(1, Integer.toString(id));
            rs = pst.executeQuery();
            
            
            
            
            if (rs.next() == true) {
				 
				 
				txtRole.setText(rs.getString("role"));
				
				
				
				passwordField_CurrentPass.setText(rs.getString("password"));
			 }
            
            // Execute the statement
            int rowsInserted = pst.executeUpdate();
            if (rowsInserted > 0) {
                JOptionPane.showMessageDialog(this, "Password saved successfully.");
            } else {
                JOptionPane.showMessageDialog(this, "Error saving password.", "Error", JOptionPane.ERROR_MESSAGE);
            }
            
            
            
        } catch (SQLException e) {
            JOptionPane.showMessageDialog(this, "Error connecting to database: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }*/
    
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(ProfilePage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(ProfilePage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(ProfilePage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(ProfilePage.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                //ProfilePage passwordManager = new ProfilePage();
                new ProfilePage().setVisible(true);
                 //if (!ProfilePage.checkLogin()) {
                   // JOptionPane.showMessageDialog(passwordManager, "Incorrect password. Exiting program.");
                   // System.exit(0);
            }
           // }
        });
    }
    
    
                
    // Variables declaration - do not modify                     
    private javax.swing.JButton jBtnSave;
    private javax.swing.JLabel jLabelPassword;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    private JButton btnEditPassword;
    private JPasswordField passwordField_CurrentPass;
    private JButton btnCheckPassword;
    private JPasswordField passwordField_NewPass;
    private JPasswordField passwordField_ConfirmPass;
    private static JTextField txtRole;
    private char[] passwordConfirm;
    private char[] passwordCorrect;
    private char[] passwordNew;
    private char[] passwordCurrent;
    private JButton btnCancel;
    private JButton btnBack;
    private JButton btnClose;
}
